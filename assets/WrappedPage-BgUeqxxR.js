import{u as V,r as h,j as e}from"./index-CSeORV3c.js";import{u as J}from"./useEvents-DgMYE35U.js";import{c as q}from"./streaks-BWXPJYOL.js";import{p as G,c as F,a as K}from"./pace-Dbu3TRjw.js";const C=[{threshold:0,text:"a journey just beginning"},{threshold:50,text:"London to Brighton"},{threshold:100,text:"across the Lake District"},{threshold:200,text:"London to Birmingham"},{threshold:300,text:"London to Bristol and back"},{threshold:400,text:"the length of Wales"},{threshold:500,text:"London to Edinburgh"},{threshold:750,text:"Land's End to John o' Groats (halfway)"},{threshold:1e3,text:"London to Barcelona"},{threshold:1500,text:"London to Rome"}];function U(l){let c=C[0];for(const d of C)l>=d.threshold&&(c=d);return c.text}const _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){const l=h.useRef(null),[c,d]=h.useState(!1);return h.useEffect(()=>{const i=l.current;if(!i)return;const x=new IntersectionObserver(([p])=>{p.isIntersecting&&(d(!0),x.unobserve(i))},{threshold:.15});return x.observe(i),()=>x.disconnect()},[]),[l,c]}function w({value:l,duration:c=1200,suffix:d="",decimals:i=0}){const[x,p]=h.useState(0),[n,f]=P();h.useEffect(()=>{if(!f||l===0)return;const g=performance.now(),N=typeof l=="number"?l:parseFloat(l)||0;function t(a){const m=a-g,b=Math.min(m/c,1),j=1-Math.pow(1-b,3);p(N*j),b<1&&requestAnimationFrame(t)}requestAnimationFrame(t)},[f,l,c]);const v=i>0?x.toFixed(i):Math.round(x).toLocaleString();return e.jsxs("span",{ref:n,children:[v,d]})}function o({children:l,delay:c=0,className:d=""}){const[i,x]=P();return e.jsx("div",{ref:i,className:d,style:{opacity:x?1:0,transform:x?"translateY(0)":"translateY(32px)",transition:`opacity 0.7s ease ${c}ms, transform 0.7s ease ${c}ms`},children:l})}function u({children:l,className:c=""}){return e.jsx("section",{className:`px-5 py-10 max-w-lg mx-auto ${c}`,children:l})}function ae(){const{state:l}=V(),{completed:c}=J(),d=h.useMemo(()=>{const t=new Set;for(const a of c)a.date&&t.add(new Date(a.date).getFullYear());return t.add(new Date().getFullYear()),[...t].sort((a,m)=>m-a)},[c]),[i,x]=h.useState(()=>new Date().getFullYear()),p=d.length>1,n=h.useMemo(()=>{const t=c.filter(s=>s.date&&new Date(s.date).getFullYear()===i),a=t.length>0?t:c,m=t.length>0,b=a.reduce((s,r)=>s+(r.distance||0)*(r.completions||1),0),j=a.reduce((s,r)=>s+(r.completions||1),0),L=a.reduce((s,r)=>s+(r.elevation||0)*(r.completions||1),0),D=a.reduce((s,r)=>{const Y=G(r.time);return Y?s+Y*(r.completions||1):s},0),W=D>0?D/3600:null,$=[...a.filter(s=>s.distance)].sort((s,r)=>r.distance-s.distance)[0]||null,T=[...a].sort((s,r)=>(r.difficulty||0)-(s.difficulty||0))[0]||null,H=[...a.filter(s=>s.elevation)].sort((s,r)=>r.elevation-s.elevation)[0]||null,B=a.map(s=>({...s,pace:F(s.time,s.distance)})).filter(s=>s.pace!=null).sort((s,r)=>s.pace-r.pace)[0]||null,k=Array(12).fill(0);if(m)for(const s of t){const r=new Date(s.date).getMonth();k[r]+=(s.distance||0)*(s.completions||1)}const R=Math.max(...k,1),M=i-1,E=c.filter(s=>s.date&&new Date(s.date).getFullYear()===M),y=E.reduce((s,r)=>s+(r.distance||0)*(r.completions||1),0),A=E.reduce((s,r)=>s+(r.completions||1),0),S=E.length>0,I=y>0?Math.round((b-y)/y*100):null,O=S?j-A:null;return{events:a,hasDateFiltering:m,totalDistance:b,totalEvents:j,totalElevation:L,totalHours:W,longestEvent:$,hardestEvent:T,mostElevationEvent:H,fastestPaceEvent:B,monthlyDistance:k,maxMonthly:R,hasPrevYear:S,prevYear:M,prevDistance:y,prevEventCount:A,distanceDelta:I,eventsDelta:O}},[c,i]),f=h.useMemo(()=>(l.preferences?.unlockedAchievements??[]).filter(a=>a.unlockedAt?new Date(a.unlockedAt).getFullYear()===i:!1),[l.preferences,i]),v=f.length>0?f:l.preferences?.unlockedAchievements??[],g=h.useMemo(()=>{const t=l.preferences?.weeklyCheckins??[],{current:a,longest:m}=q(t);return{current:a,longest:m,totalWeeks:t.length}},[l.preferences]),N=U(n.totalDistance);return e.jsxs("div",{className:"min-h-screen bg-gray-950 pb-24 sm:pb-8",children:[e.jsx(u,{className:"pt-16 pb-6 text-center",children:e.jsxs(o,{children:[e.jsx("p",{className:"text-gray-500 text-sm uppercase tracking-widest font-medium mb-4",children:"Year in Review"}),e.jsxs("h1",{className:"text-5xl sm:text-6xl font-black leading-tight",style:{background:"linear-gradient(135deg, #667eea 0%, #f093fb 50%, #f5576c 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["Your ",i]}),p&&e.jsx("div",{className:"flex items-center justify-center gap-2 mt-6",children:d.map(t=>e.jsx("button",{onClick:()=>x(t),className:`px-3 py-1.5 rounded-full text-sm font-bold transition-all ${t===i?"bg-white/10 text-white border border-white/20":"text-gray-500 hover:text-gray-300"}`,children:t},t))})]})}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{value:n.totalDistance,suffix:"km",label:"Distance Covered",gradient:"from-emerald-400 to-cyan-400"},{value:n.totalEvents,suffix:"",label:"Events Completed",gradient:"from-violet-400 to-purple-400"},{value:n.totalElevation,suffix:"m",label:"Elevation Gained",gradient:"from-amber-400 to-orange-400"},...n.totalHours?[{value:n.totalHours,suffix:"h",label:"Hours on Feet",gradient:"from-rose-400 to-pink-400",decimals:1}]:[]].map((t,a)=>e.jsx(o,{delay:a*100,children:e.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-5 border border-gray-700/30 text-center",children:[e.jsx("div",{className:`text-3xl sm:text-4xl font-black bg-gradient-to-r ${t.gradient} bg-clip-text text-transparent`,children:e.jsx(w,{value:t.value,suffix:t.suffix,decimals:t.decimals||0})}),e.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-wider mt-2 font-bold",children:t.label})]})},t.label))})}),e.jsxs(u,{children:[e.jsx(o,{children:e.jsx("h2",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-5",children:"Highlights"})}),e.jsx("div",{className:"space-y-3",children:[n.longestEvent&&{icon:"ðŸ…",label:"Longest Event",value:`${n.longestEvent.distance}km`,name:n.longestEvent.name,color:"#10b981"},n.hardestEvent&&{icon:"ðŸ”¥",label:"Hardest Event",value:`${n.hardestEvent.difficulty}/5`,name:n.hardestEvent.name,color:"#ef4444"},n.mostElevationEvent&&{icon:"â›°ï¸",label:"Most Elevation",value:`${n.mostElevationEvent.elevation.toLocaleString()}m`,name:n.mostElevationEvent.name,color:"#f59e0b"},n.fastestPaceEvent&&{icon:"âš¡",label:"Fastest Pace",value:K(F(n.fastestPaceEvent.time,n.fastestPaceEvent.distance)),name:n.fastestPaceEvent.name,color:"#06b6d4"}].filter(Boolean).map((t,a)=>e.jsx(o,{delay:a*80,children:e.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-4 border border-gray-700/30 flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-wider font-bold",children:t.label}),e.jsx("div",{className:"text-white font-black text-lg truncate",style:{color:t.color},children:t.value}),e.jsx("div",{className:"text-gray-400 text-xs truncate",children:t.name})]})]})},t.label))})]}),n.hasDateFiltering&&e.jsxs(u,{children:[e.jsx(o,{children:e.jsx("h2",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-5",children:"Monthly Distance"})}),e.jsx(o,{delay:100,children:e.jsx("div",{className:"bg-gray-800/40 rounded-2xl p-5 border border-gray-700/30",children:e.jsx("div",{className:"flex items-end gap-1.5 h-40",children:n.monthlyDistance.map((t,a)=>{const m=n.maxMonthly>0?Math.max(t/n.maxMonthly*100,t>0?4:0):0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"w-full flex flex-col items-center justify-end flex-1",children:[t>0&&e.jsx("span",{className:"text-[9px] text-gray-400 font-bold mb-1",children:Math.round(t)}),e.jsx("div",{className:"w-full rounded-t-md transition-all duration-700",style:{height:`${m}%`,background:t>0?"linear-gradient(180deg, #667eea 0%, #764ba2 100%)":"transparent",minHeight:t>0?"4px":"0"}})]}),e.jsx("span",{className:"text-[9px] text-gray-600 font-medium",children:_[a]})]},a)})})})})]}),v.length>0&&e.jsxs(u,{children:[e.jsx(o,{children:e.jsx("h2",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-5",children:"Achievements Unlocked"})}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:v.map((t,a)=>e.jsx(o,{delay:a*60,children:e.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-4 border border-gray-700/30 text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:t.icon}),e.jsx("div",{className:"text-white font-bold text-sm",children:t.name}),e.jsx("div",{className:"text-gray-500 text-[10px] mt-1 leading-snug",children:t.description})]})},t.id))})]}),g.totalWeeks>0&&e.jsxs(u,{children:[e.jsx(o,{children:e.jsx("h2",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-5",children:"Training Streaks"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{delay:0,children:e.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-5 border border-gray-700/30 text-center",children:[e.jsx("div",{className:"text-3xl sm:text-4xl font-black bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent",children:e.jsx(w,{value:g.longest,suffix:"w"})}),e.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-wider mt-2 font-bold",children:"Longest Streak"})]})}),e.jsx(o,{delay:100,children:e.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-5 border border-gray-700/30 text-center",children:[e.jsx("div",{className:"text-3xl sm:text-4xl font-black bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent",children:e.jsx(w,{value:g.totalWeeks,suffix:""})}),e.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-wider mt-2 font-bold",children:"Total Check-in Weeks"})]})})]}),g.current>0&&e.jsx(o,{delay:200,children:e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-400 text-sm font-bold",children:[g.current,"w current streak â€” keep it going"]})})})]}),n.hasPrevYear&&e.jsxs(u,{children:[e.jsx(o,{children:e.jsxs("h2",{className:"text-xs uppercase tracking-widest text-gray-500 font-bold mb-5",children:[i," vs ",n.prevYear]})}),e.jsx("div",{className:"space-y-3",children:[{label:"Distance",delta:n.distanceDelta,suffix:"%"},{label:"Events",delta:n.eventsDelta,suffix:"",isAbsolute:!0}].map((t,a)=>e.jsx(o,{delay:a*100,children:e.jsxs("div",{className:"bg-gray-800/40 rounded-2xl p-4 border border-gray-700/30 flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400 text-sm font-medium",children:t.label}),t.delta!=null?e.jsxs("span",{className:`text-lg font-black ${t.delta>=0?"text-emerald-400":"text-red-400"}`,children:[t.delta>=0?"+":"",t.delta,t.isAbsolute?"":t.suffix,!t.isAbsolute&&" vs last year",t.isAbsolute&&" vs last year"]}):e.jsx("span",{className:"text-gray-600 text-sm",children:"No prior data"})]})},t.label))})]}),e.jsx(u,{className:"text-center pb-20",children:e.jsx(o,{children:e.jsxs("div",{className:"py-10",children:[e.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"This year you covered"}),e.jsxs("div",{className:"text-5xl sm:text-6xl font-black mb-4",style:{background:"linear-gradient(135deg, #10b981 0%, #06b6d4 50%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:[n.totalDistance.toLocaleString(),"km"]}),e.jsxs("p",{className:"text-gray-400 text-lg mb-8",children:["That's"," ",e.jsx("span",{className:"text-white font-bold",children:N}),"."]}),e.jsx("div",{className:"inline-block px-6 py-3 rounded-2xl border border-gray-700/30",style:{background:"linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(240,147,251,0.1) 100%)"},children:e.jsx("p",{className:"text-white font-bold text-lg",children:"Keep going."})})]})})})]})}export{ae as default};
