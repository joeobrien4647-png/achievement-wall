import{u as T,r as x,j as e,C as W}from"./index-DRgCCeWg.js";import{u as Y}from"./useEvents-CCzazLsy.js";import{C as $}from"./chevron-left-BdWt5xoj.js";const E=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],F=[{color:"#10b981",label:"Completed"},{color:"#ef4444",label:"Upcoming"},{color:"#f59e0b",label:"Check-in Week"}];function f(a){const s=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${s}-${c}-${d}`}function G(a){const s=new Date(a),c=s.getDay(),d=c===0?6:c-1;return s.setDate(s.getDate()-d),f(s)}function A(a,s){const c=new Date(a,s,1),d=new Date(a,s+1,0);let g=c.getDay()-1;g<0&&(g=6);const m=[];for(let n=0;n<g;n++)m.push(null);for(let n=1;n<=d.getDate();n++)m.push(new Date(a,s,n));for(;m.length%7!==0;)m.push(null);return m}function I(){const{events:a}=Y(),{state:s}=T(),c=new Date;c.setHours(0,0,0,0);const d=f(c),[g,m]=x.useState(()=>new Date(c.getFullYear(),c.getMonth(),1)),[n,p]=x.useState(null),j=g.getFullYear(),k=g.getMonth(),C=x.useCallback(()=>{m(t=>new Date(t.getFullYear(),t.getMonth()-1,1)),p(null)},[]),M=x.useCallback(()=>{m(t=>new Date(t.getFullYear(),t.getMonth()+1,1)),p(null)},[]),{completedMap:w,upcomingMap:N,checkinMondays:v}=x.useMemo(()=>{const t=new Map,i=new Map;for(const l of a){if(!l.date)continue;const h=l.date.slice(0,10);if(l.status==="completed"){const u=t.get(h);t.set(h,u?[...u,l]:[l])}else if(l.status==="upcoming"){const u=i.get(h);i.set(h,u?[...u,l]:[l])}}const r=new Set(s.preferences?.weeklyCheckins??[]);return{completedMap:t,upcomingMap:i,checkinMondays:r}},[a,s.preferences?.weeklyCheckins]),S=x.useMemo(()=>A(j,k),[j,k]),y=x.useCallback(t=>{if(!t)return null;const i=f(t),r=G(t);return{iso:i,completed:w.get(i)??[],upcoming:N.get(i)??[],isCheckinWeek:v.has(r),isToday:i===d}},[w,N,v,d]),o=x.useMemo(()=>n?y(n):null,[n,y]),L=g.toLocaleDateString("en-GB",{month:"long",year:"numeric"});return e.jsxs("div",{className:"px-4 pb-24 sm:pb-8 pt-4 space-y-5",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-white mb-1",children:"Calendar"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Your training and event schedule"})]}),e.jsxs("div",{className:"bg-gray-800/60 rounded-2xl border border-gray-700/50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:C,className:"p-1.5 rounded-lg hover:bg-gray-700/50 text-gray-400 hover:text-white transition-colors","aria-label":"Previous month",children:e.jsx($,{size:20})}),e.jsx("h3",{className:"text-white font-bold text-base",children:L}),e.jsx("button",{onClick:M,className:"p-1.5 rounded-lg hover:bg-gray-700/50 text-gray-400 hover:text-white transition-colors","aria-label":"Next month",children:e.jsx(W,{size:20})})]}),e.jsx("div",{className:"grid grid-cols-7 px-3 pb-1",children:E.map(t=>e.jsx("div",{className:"text-center text-[10px] font-bold text-gray-500 uppercase tracking-wider py-1",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 px-3 pb-3 gap-y-1",children:S.map((t,i)=>{if(!t)return e.jsx("div",{className:"aspect-square"},`blank-${i}`);const r=y(t),l=n&&f(n)===r.iso,h=r.completed.length>0,u=r.upcoming.length>0,D=r.isCheckinWeek,b=h||u||D;return e.jsxs("button",{onClick:()=>p(b?l?null:t:null),className:`
                  aspect-square rounded-xl flex flex-col items-center justify-center gap-0.5
                  transition-all text-sm relative
                  ${r.isToday?"ring-2 ring-indigo-500 ring-offset-1 ring-offset-gray-800":""}
                  ${l?"bg-gray-700/80":b?"hover:bg-gray-700/40 cursor-pointer":"cursor-default"}
                `,children:[e.jsx("span",{className:`font-medium ${r.isToday?"text-indigo-400":l?"text-white":"text-gray-300"}`,children:t.getDate()}),b&&e.jsxs("div",{className:"flex gap-0.5",children:[h&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),u&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),D&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"})]})]},r.iso)})})]}),e.jsx("div",{className:"flex items-center justify-center gap-5",children:F.map(t=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-400",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),t.label]},t.label))}),o&&e.jsxs("div",{className:"bg-gray-800/60 rounded-2xl border border-gray-700/50 p-4 space-y-3 animate-in slide-in-from-bottom-2 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-white font-bold text-sm",children:n.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>p(null),className:"text-gray-500 hover:text-white text-xs",children:"Close"})]}),o.completed.map(t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:"#10b981"}}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-white text-sm font-medium truncate",children:[t.badge," ",t.name]}),t.distance&&e.jsxs("div",{className:"text-gray-500 text-xs",children:[t.distance,"km"]})]})]},t.id)),o.upcoming.map(t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:"#ef4444"}}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-white text-sm font-medium truncate",children:[t.badge," ",t.name]}),t.distance&&e.jsxs("div",{className:"text-gray-500 text-xs",children:[t.distance,"km"]})]})]},t.id)),o.isCheckinWeek&&o.completed.length===0&&o.upcoming.length===0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:"#f59e0b"}}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Training check-in week"})]}),o.isCheckinWeek&&(o.completed.length>0||o.upcoming.length>0)&&e.jsxs("div",{className:"text-amber-500/80 text-xs flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),"Training check-in week"]})]})]})}export{I as default};
